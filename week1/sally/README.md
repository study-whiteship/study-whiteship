## 목표

자바 소스 파일(.java)을 JVM으로 실행하는 과정 이해하기.

## 학습할 것

- JVM이란 무엇인가
- 컴파일 하는 방법
- 실행하는 방법
- 바이트코드란 무엇인가
- JIT 컴파일러란 무엇이며 어떻게 동작하는지
- JVM 구성 요소
- JDK와 JRE의 차이

### JVM이란 무엇인가

JVM은 Java Virtual Machine의 약자로 자바를 실행하기 위한 가상 기계(컴퓨터)이다. 가상 컴퓨터는 하드웨어가 아닌 소프트웨어로 컴퓨터 속의 컴퓨터라고 생각하면 된다. 자바로 작성된 모든 프로그램은 JVM에서만 실행된다. JVM은 운영체제가 바뀌어도 실행할 수 있게끔 해준다.

### 컴파일 하는 방법

컴파일은 소스코드를 모두 기계어 파일로 바꿔주는 과정을 말한다. 자바에서 빌드 시, 자바 컴파일러는 'javac'라는 명령어를 통해 자바파일(.java)을 반기계어인 자바 바이트코드(.class)로 바꿔준다. 

```
javac hello.java
```

### 실행하는 방법

컴파일 된 클래스파일을 'java'라는 명령어를 이용하면 실행된다. 하지만 여기서 파일 확장자는 빼줄 것! 스페이스를 주고 매개변수(메인 메서드의 String[] args에 해당)를 전달할 수 있다. 

```
java hello
```

### 바이트코드란 무엇인가

자바 바이트코드란 자바파일이 컴파일을 통해 변환된 JVM이 읽을 수 있는 반기계어다. 변환된 코드의 명령어 크기가 1바이트라서 바이트코드라고 불린다고 한다. JVM은 이 바이트코드를 운영체제에 맞게 기계어로 해석해준다.

### JIT 컴파일러란 무엇이며 어떻게 동작하는가

바이트코드는 JVM내로 로드되고 실행엔진에 의해 기계어로 해석된다. Interpreter는 바이트코드를 한줄씩 읽어 해석하고 실행하는데 이런 방식은 속도가 느리다는 단점이 있어 이 단점을 보완하기 위해 나온 것이 JIT 컴파일러다. 처음에는 인터프리터로 바이트코드를 해석하다가 한 번 실행되었던 메소드가 재호출될 때 해당 바이트코드를 통째로 기계어로 변환시켜주어 바로 실행시켜준다. 이 방법은 동적번역(dynamic translation)이라고도 부른다.

### JVM 구성 요소

JVM은 실행엔진과 Runtime Data Area 그리고 클래스로더로 구성되어있다.

#### Class Loader

클래스로더는 JVM으로 클래스파일을 로드해주는 역할을 맡는다. 자바는 동적으로 클래스를 로드하기 때문에 필요한 부분(실행이 될 때)만 로딩해서 사용하게 된다. 클래스로더는 로딩, 링킹, 초기화 과정을 통해 동작한다.

- 로딩: 클래스정보 메모리를 로딩한다.
- 링킹
  - 바이트코드가 적절한지 검사하고 검사에 실패하면 verification error를 띄운다. 
  - 모든 정적변수(static)들의 메모리가 할당되고 기본값이 할당된다.
  - 심볼릭 메모리 참조가 원래 참조로 대체된다. // 모르겠다
- 초기화: 정적변수를 초기값으로 저장하고 static block을 실행시킨다.

#### Runtime Data

- 메소드 영역: 정적변수를 포함한 클래스 레벨의 데이터가 저장된다. 한 JVM당 하나만 있으며 공유되는 자원이다.
- 힙 영역: 만들어진 객체, 인스턴스 변수와 배열이 저장된다. 힙 또한 메소드 영역과 같이 하나만 있으며 따라서 공유되는 자원이다.
- 스택 영역: 스레드마다 생성되는 영역이다. 메서드가 실행되면 해당 메서드에 관련된 정보가 스택프레임 형태로 저장이 된다. 스택 프레임에는 지역변수, 매개변수, 리턴값 등이 저장된다.
- PC Register: JVM 명령의 주소값이 저장된다. 스택 영역과 같이 스레드마다 생성된다.

#### Execution Engine

- Interpreter: 바이트코드를 해석한다. 단점은 메소드가 실행될 때마다 해석을 새로 한다.

- JIT Compiler: 한 번 실행되었던 메소드가 재호출될 때 기계어로 바꾸어주어 인터프리터의 단점을 줄여준다.

- Garbage Collector: 사용되지 않는 객체를 버려준다.

### JDK와 JRE의 차이

JDK는 자발 개발도구이고 JRE를 포함하고 있다. JRE는 자바 애플리케이션을 생성하고 실행하기 위한 최소한의 환경을 의미한다.

